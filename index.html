<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f4f8;
        padding: 30px;
        color: #333;
      }
      h1 {
        text-align: center;
        color: #081c8c;
      }
      .container {
        max-width: 1200px; /* Widen container for columns */
        margin: 0 auto;
        background: #fff;
        padding: 20px 30px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      h2 {
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      .create-project {
        display: grid;
        gap: 15px;
        margin-bottom: 20px;
      }
      .form-group {
        display: flex;
        flex-direction: column;
      }
      .form-group label {
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 14px;
      }
      #new-project-sorter,
      #new-project-name {
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box;
      }
      #create-project-btn {
        padding: 12px 20px;
        font-size: 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        justify-self: start;
      }
      #create-project-btn:hover {
        background-color: #0056b3;
      }

      /* **** NEW: Styles for Columnar Layout **** */
      #project-list {
        display: grid;
        /* Create columns that are at least 300px wide, 
           and wrap automatically */
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        padding: 0;
      }
      .sorter-group {
        background: #fdfdfd;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
      }
      h3.sorter-group-title {
        font-size: 1.2em;
        color: #081c8c;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-top: 0;
        margin-bottom: 15px;
      }
      ul.project-group-list {
        list-style: none;
        padding: 0;
      }
      /* **** END NEW STYLES **** */

      #project-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
        background: #f9f9f9;
      }
      #project-list .project-info a {
        font-size: 18px;
        text-decoration: none;
        color: #0056b3;
        font-weight: bold;
        display: block;
      }
      #project-list .project-info span {
        font-size: 14px;
        color: #555;
      }
      .delete-project-btn {
        padding: 5px 10px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Project Dashboard</h1>

      <h2>Create New Project</h2>
      <div class="create-project">
        <div class="form-group">
          <label for="new-project-sorter">1. Select Sorter Type</label>
          <select id="new-project-sorter">
            <option value="">-- Please select a sorter --</option>
            <option value="NIDO 2:8 Sorter">NIDO 2:8 Sorter</option>
            <option value="NIDO 1:4 Sorter">NIDO 1:4 Sorter</option>
            <option value="NIDO Arm Sorter">NIDO Arm Sorter</option>
            <option value="Falcon Arm Sorter">Falcon Arm Sorter</option>
            <option value="Falcon CBS Sorter">Falcon CBS Sorter</option>
            <option value="Falcon Bag Sorter">Falcon Bag Sorter</option>
          </select>
        </div>

        <div class="form-group">
          <label for="new-project-name">2. Enter Project Name</label>
          <input
            type="text"
            id="new-project-name"
            placeholder="e.g., Client ABC Implementation"
          />
        </div>

        <button id="create-project-btn">Create Project</button>
      </div>

      <h2>Existing Projects</h2>
      <div id="project-list">
        </div>
    </div>

    <script>
      const projectListEl = document.getElementById("project-list");
      const createBtn = document.getElementById("create-project-btn");
      const newProjectNameEl = document.getElementById("new-project-name");
      const newProjectSorterEl = document.getElementById("new-project-sorter");

      // **** UPDATED: This function now groups projects by sorter type ****
      function loadProjects() {
        const projects =
          JSON.parse(localStorage.getItem("NidoProjectList")) || [];
        projectListEl.innerHTML = ""; // Clear list

        if (projects.length === 0) {
          projectListEl.innerHTML = "<p>No projects created yet.</p>";
          return;
        }

        // Get all unique sorter types from the saved projects
        const sorterTypes = [
          ...new Set(projects.map((p) => p.sorterType)),
        ].sort();

        // Loop through each sorter type and create a column for it
        sorterTypes.forEach((sorterType) => {
          // 1. Create the wrapper for this column
          const groupWrapper = document.createElement("div");
          groupWrapper.className = "sorter-group";

          // 2. Create the title (e.g., "NIDO 2:8 Sorter")
          const heading = document.createElement("h3");
          heading.className = "sorter-group-title";
          heading.textContent = sorterType;
          groupWrapper.appendChild(heading);

          // 3. Create the list for this group's projects
          const list = document.createElement("ul");
          list.className = "project-group-list";

          // 4. Get only projects that match this sorter type
          const projectsForThisSorter = projects.filter(
            (p) => p.sorterType === sorterType
          );

          // 5. Create and add each project <li>
          projectsForThisSorter.forEach((project) => {
            const li = document.createElement("li");
            li.innerHTML = `
              <div class="project-info">
                <a href="project.html?id=${project.id}">${project.name}</a>
                <span>${project.sorterType}</span>
              </div>
              <button class="delete-project-btn" data-id="${project.id}">Delete</button>
            `;
            list.appendChild(li);
          });

          // 6. Add the list to the wrapper, and the wrapper to the main list
          groupWrapper.appendChild(list);
          projectListEl.appendChild(groupWrapper);
        });
      }

      // Create a new project
      createBtn.addEventListener("click", () => {
        const sorterType = newProjectSorterEl.value;
        const projectName = newProjectNameEl.value.trim();

        if (sorterType === "") {
          alert("Please select a sorter type.");
          return;
        }
        if (projectName === "") {
          alert("Please enter a project name.");
          return;
        }

        const projects =
          JSON.parse(localStorage.getItem("NidoProjectList")) || [];
        
        const newProject = {
          id: "pid_" + new Date().getTime(),
          name: projectName,
          sorterType: sorterType,
        };

        projects.push(newProject);
        localStorage.setItem("NidoProjectList", JSON.stringify(projects));
        window.location.href = `project.html?id=${newProject.id}`;
      });

      // Handle deleting a project
      projectListEl.addEventListener("click", (e) => {
        if (e.target.classList.contains("delete-project-btn")) {
          if (!confirm("Are you sure you want to delete this project?")) return;

          const projectId = e.target.dataset.id;
          let projects =
            JSON.parse(localStorage.getItem("NidoProjectList")) || [];
          projects = projects.filter((p) => p.id !== projectId);

          localStorage.setItem("NidoProjectList", JSON.stringify(projects));
          localStorage.removeItem(`NidoProjectData-${projectId}`);

          loadProjects(); // Reload list
        }
      });

      // Initial load
      loadProjects();
    </script>
  </body>
</html>
